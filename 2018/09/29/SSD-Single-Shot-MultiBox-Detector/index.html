<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.1" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.1">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.1" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="作者主页：https://www.cs.unc.edu/~wliu/arxiv: http://arxiv.org/abs/1512.02325paper: http://www.cs.unc.edu/~wliu/papers/ssd.pdfslides: http://www.cs.unc.edu/%7Ewliu/papers/ssd_eccv2016_slide.pdfcode: https">
<meta name="keywords" content="Object Detection">
<meta property="og:type" content="article">
<meta property="og:title" content="SSD: Single Shot MultiBox Detector">
<meta property="og:url" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/index.html">
<meta property="og:site_name" content="Zhang Bin&#39;s Blog">
<meta property="og:description" content="作者主页：https://www.cs.unc.edu/~wliu/arxiv: http://arxiv.org/abs/1512.02325paper: http://www.cs.unc.edu/~wliu/papers/ssd.pdfslides: http://www.cs.unc.edu/%7Ewliu/papers/ssd_eccv2016_slide.pdfcode: https">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/00.png">
<meta property="og:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/01.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*I79wnE3675HYqcMKMm7yHg.png">
<meta property="og:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/02.png">
<meta property="og:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/03.png">
<meta property="og:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/04.png">
<meta property="og:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/05.png">
<meta property="og:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/07.png">
<meta property="og:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/08.png">
<meta property="og:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/06.png">
<meta property="og:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/09.png">
<meta property="og:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/10.png">
<meta property="og:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/11.png">
<meta property="og:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/12.png">
<meta property="og:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/13.png">
<meta property="og:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/14.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/17454232/37581759-e15bcc98-2b84-11e8-9945-1325dcaf206a.png">
<meta property="og:updated_time" content="2018-10-04T10:45:59.362Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SSD: Single Shot MultiBox Detector">
<meta name="twitter:description" content="作者主页：https://www.cs.unc.edu/~wliu/arxiv: http://arxiv.org/abs/1512.02325paper: http://www.cs.unc.edu/~wliu/papers/ssd.pdfslides: http://www.cs.unc.edu/%7Ewliu/papers/ssd_eccv2016_slide.pdfcode: https">
<meta name="twitter:image" content="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/00.png">






  <link rel="canonical" href="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>SSD: Single Shot MultiBox Detector | Zhang Bin's Blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zhang Bin's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Less interests, more interest!!!</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />Categories</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />About</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/29/SSD-Single-Shot-MultiBox-Detector/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bin Zhang">
      <meta itemprop="description" content="I am currently a Master candidate in Wuhan University majoring Photogrammetry and remote sensing">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang Bin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">SSD: Single Shot MultiBox Detector
              
            
          </h1>
        

        <div class="post-meta">
		
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-09-29 22:14:52" itemprop="dateCreated datePublished" datetime="2018-09-29T22:14:52+08:00">2018-09-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-10-04 18:45:59" itemprop="dateModified" datetime="2018-10-04T18:45:59+08:00">2018-10-04</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Object-Detection/" itemprop="url" rel="index"><span itemprop="name">Object Detection</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">5.6k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">5 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <a id="more"></a>
<p>作者主页：<a href="https://www.cs.unc.edu/~wliu/" target="_blank" rel="noopener">https://www.cs.unc.edu/~wliu/</a><br>arxiv: <a href="http://arxiv.org/abs/1512.02325" target="_blank" rel="noopener">http://arxiv.org/abs/1512.02325</a><br>paper: <a href="http://www.cs.unc.edu/~wliu/papers/ssd.pdf" target="_blank" rel="noopener">http://www.cs.unc.edu/~wliu/papers/ssd.pdf</a><br>slides: <a href="http://www.cs.unc.edu/%7Ewliu/papers/ssd_eccv2016_slide.pdf" target="_blank" rel="noopener">http://www.cs.unc.edu/%7Ewliu/papers/ssd_eccv2016_slide.pdf</a><br>code: <a href="https://github.com/weiliu89/caffe/tree/ssd" target="_blank" rel="noopener">https://github.com/weiliu89/caffe/tree/ssd</a></p>
<h1 id="Network-Structure"><a href="#Network-Structure" class="headerlink" title="Network Structure"></a>Network Structure</h1><p><img src="/2018/09/29/SSD-Single-Shot-MultiBox-Detector/00.png" alt=""><br>SSD全部使用了卷积层，并且在多个特征图使用3×3的卷积预测bounding box及其种类。</p>
<h2 id="Base-Network"><a href="#Base-Network" class="headerlink" title="Base Network"></a>Base Network</h2><p>Base Network为VGG16，与原始的VGG16的不同为：</p>
<ul>
<li>将fc6和fc7由全连接层转为卷积层，fc6为dilation为6的3×3卷积，fc7为1×1的卷积</li>
<li>将pool5的2×2的size，stride为2转为3×3的size，stride为1</li>
</ul>
<h2 id="Multi-scale-feature-maps-for-detection"><a href="#Multi-scale-feature-maps-for-detection" class="headerlink" title="Multi-scale feature maps for detection"></a>Multi-scale feature maps for detection</h2><p>SSD中一共使用了6个不同尺度的特征图，分别为：Conv4_3，fc7，Conv8_2，Conv9_2，Conv10_2，Conv11_2，其中Conv4_3，fc7为Base Network中的。Conv4_3特征图大小为38×38，fc7特征图大小为19×19。在Base Network后又加了额外的的结构，特征图大小持续减小到1×1： </p>
<ul>
<li>Conv8_1: 1x1x256 Conv8_2: 3x3x512-s2 feature map size: 10×10</li>
<li>Conv9_1: 1x1x128 Conv9_2: 3x3x256-s2 feature map size: 5×5</li>
<li>Conv10_1: 1x1x128 Conv10_2: 3x3x256-s1 feature map size: 3×3</li>
<li>Conv11_1: 1x1x128 Conv11_2: 3x3x256-s1 feature map size: 1×1</li>
</ul>
<h2 id="Convolutional-predictors-for-detection"><a href="#Convolutional-predictors-for-detection" class="headerlink" title="Convolutional predictors for detection"></a>Convolutional predictors for detection</h2><p>对于这6个特征图，每个位置会生成多个大小和比例的default box，在每个特征图上使用3×3的卷积预测每个位置的每个bounding box的score for a category和shape offset relative to the default box coordinates。例如对Conv4_3特征图来说，Conv4_3 shape为(38,38,512), 每个位置生成4个default box，假设有classes个类别，使用4classes个卷积核为3×3×512的卷积预测每个bounding box对每个类别得分，由于预测一个bounding box需要4个参数，所以使用4*4个卷积核为3×3×512的卷积预测ground truth bounding box对每个default bounding box的偏移。<br>6个特征图一共可以生成8732个default box，Conv4_3，Conv10_2，Conv11_2采用了4种大小的box，Conv7，Conv8_2，Conv9_2采用了6种大小的box：</p>
<ul>
<li>Conv4_3: 38 × 38 × 4 = 5776</li>
<li>Conv7: 19 × 19 × 6 = 2166</li>
<li>Conv8_2: 10 × 10 × 6 = 600</li>
<li>Conv9_2: 5 × 5 × 6 = 150</li>
<li>Conv10_2: 3 × 3 × 4 = 36</li>
<li>Conv11_2: 4</li>
</ul>
<p>Total: 5776+ 2166 + 600 + 150 + 36 + 4 = 8732</p>
<h1 id="训练时需要解决的问题"><a href="#训练时需要解决的问题" class="headerlink" title="训练时需要解决的问题"></a>训练时需要解决的问题</h1><h2 id="Matching-strategy"><a href="#Matching-strategy" class="headerlink" title="Matching strategy"></a>Matching strategy</h2><p><img src="/2018/09/29/SSD-Single-Shot-MultiBox-Detector/01.png" alt=""><br>训练时需要确定哪个default box和ground truth对应起来。首先将与ground truth的IoU最大的default box作为正样本，这样每个ground truth对应一个正样本，然后将default box与ground truth的IoU大于0.5的作为正样本，这样每个ground truth至少对应一个正样本。</p>
<h2 id="Training-objective"><a href="#Training-objective" class="headerlink" title="Training objective"></a>Training objective</h2><p>损失函数包括两部分： localization loss (loc)和confidence loss (conf)，权重项α通过交叉验证设为1<br><img src="https://cdn-images-1.medium.com/max/800/1*I79wnE3675HYqcMKMm7yHg.png" alt=""><br>其中localization loss只针对正样本而言，为 predicted box (l) 和 ground truth box (g)参数的Smooth L1 loss，具体做法为回归ground truth bounding box和default box关于中心x，y和宽w，高h的相对偏移：<br><img src="/2018/09/29/SSD-Single-Shot-MultiBox-Detector/02.png" alt=""><br>confidence loss为softmax loss，对正样本来说需要其对应类别的概率最大，对负样本来说需要其检测为背景的概率最大：<br><img src="/2018/09/29/SSD-Single-Shot-MultiBox-Detector/03.png" alt=""></p>
<h2 id="Choosing-scales-and-aspect-ratios-for-default-boxes"><a href="#Choosing-scales-and-aspect-ratios-for-default-boxes" class="headerlink" title="Choosing scales and aspect ratios for default boxes"></a>Choosing scales and aspect ratios for default boxes</h2><p>假设有m个特征图，每个特征图的default box的scale按以下公式计算：<br><img src="/2018/09/29/SSD-Single-Shot-MultiBox-Detector/04.png" alt=""><br>有了scale就可以计算box的w和h，作者一共采用了6中长宽和大小不同的box：</p>
<ul>
<li>比例α为{1,2,3,1/2,1/3}，w=s*sqrt(α)，h=s/sqrt(α)</li>
<li>正方形w=h=s=sqrt(sk*sk+1)</li>
</ul>
<h2 id="Hard-negative-mining"><a href="#Hard-negative-mining" class="headerlink" title="Hard negative mining"></a>Hard negative mining</h2><p>由于大多数default box是负样本，如果使用全部的负样本训练会使训练不稳定，因此对负样本对confidence loss进行降序排列，选择最高前3倍的正样本数量的进行训练，控制负样本和正样本比例为3:1。</p>
<h2 id="Data-augmentation"><a href="#Data-augmentation" class="headerlink" title="Data augmentation"></a>Data augmentation</h2><ul>
<li>Use the entire original input image.</li>
<li>Sample a patch so that the minimum jaccard overlap with the objects is 0.1, 0.3, 0.5, 0.7, or 0.9.</li>
<li>Randomly sample a patch.</li>
<li>resized to fixed size</li>
<li>horizontally flipped with probability of 0.5</li>
<li>applying some photo-metric distortions<h2 id="Non-Maximum-Suppression"><a href="#Non-Maximum-Suppression" class="headerlink" title="Non-Maximum Suppression"></a>Non-Maximum Suppression</h2>SSD sorts the predictions by the confidence scores. Start from the top confidence prediction, SSD evaluates whether any previously predicted boundary boxes have an IoU higher than 0.45 with the current prediction for the same class. If found, the current prediction will be ignored. At most, we keep the top 200 predictions per image.</li>
</ul>
<h1 id="Experimental-Results"><a href="#Experimental-Results" class="headerlink" title="Experimental Results"></a>Experimental Results</h1><h2 id="PASCAL-VOC2007"><a href="#PASCAL-VOC2007" class="headerlink" title="PASCAL VOC2007"></a>PASCAL VOC2007</h2><p><img src="/2018/09/29/SSD-Single-Shot-MultiBox-Detector/05.png" alt=""><br><img src="/2018/09/29/SSD-Single-Shot-MultiBox-Detector/07.png" alt=""></p>
<ul>
<li>can detect various object categories with high quality</li>
<li>has less localization error, indicating that SSD can localize objects better because it directly learns to regress the object shape and classify object categories instead of using two decoupled steps</li>
<li>more confusions with similar object categories (especially for animals)</li>
</ul>
<p><img src="/2018/09/29/SSD-Single-Shot-MultiBox-Detector/08.png" alt=""></p>
<ul>
<li>very sensitive to the bounding box size</li>
<li>has much worse performance on smaller objects than bigger objects</li>
<li>performs really well on large objects</li>
<li>very robust to different object aspect ratios because use default boxes of various aspect ratios per feature map location</li>
</ul>
<h2 id="Model-analysis"><a href="#Model-analysis" class="headerlink" title="Model analysis"></a>Model analysis</h2><p><img src="/2018/09/29/SSD-Single-Shot-MultiBox-Detector/06.png" alt=""><br><img src="/2018/09/29/SSD-Single-Shot-MultiBox-Detector/09.png" alt=""></p>
<ul>
<li>Data augmentation is crucial</li>
<li>More default box shapes is better</li>
<li>Atrous is faster</li>
<li>Multiple output layers at different resolutions is better</li>
</ul>
<h2 id="PASCAL-VOC2012"><a href="#PASCAL-VOC2012" class="headerlink" title="PASCAL VOC2012"></a>PASCAL VOC2012</h2><p><img src="/2018/09/29/SSD-Single-Shot-MultiBox-Detector/10.png" alt=""></p>
<h2 id="COCO"><a href="#COCO" class="headerlink" title="COCO"></a>COCO</h2><p><img src="/2018/09/29/SSD-Single-Shot-MultiBox-Detector/11.png" alt=""></p>
<h2 id="Data-Augmentation-for-Small-Object-Accuracy"><a href="#Data-Augmentation-for-Small-Object-Accuracy" class="headerlink" title="Data Augmentation for Small Object Accuracy"></a>Data Augmentation for Small Object Accuracy</h2><p><img src="/2018/09/29/SSD-Single-Shot-MultiBox-Detector/12.png" alt=""><br><img src="/2018/09/29/SSD-Single-Shot-MultiBox-Detector/13.png" alt=""></p>
<h2 id="Inference-time"><a href="#Inference-time" class="headerlink" title="Inference time"></a>Inference time</h2><p><img src="/2018/09/29/SSD-Single-Shot-MultiBox-Detector/14.png" alt=""></p>
<h1 id="其他细节"><a href="#其他细节" class="headerlink" title="其他细节"></a>其他细节</h1><ol>
<li><p><strong>Prior Box min size和max size的生成方式</strong>：<br>见源码中ssd_pascal.py文件:</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parameters for generating priors.</span></span><br><span class="line"><span class="comment"># minimum dimension of input image</span></span><br><span class="line">min_dim = 300</span><br><span class="line"><span class="comment"># conv4_3 ==&gt; 38 x 38</span></span><br><span class="line"><span class="comment"># fc7 ==&gt; 19 x 19</span></span><br><span class="line"><span class="comment"># conv6_2 ==&gt; 10 x 10</span></span><br><span class="line"><span class="comment"># conv7_2 ==&gt; 5 x 5</span></span><br><span class="line"><span class="comment"># conv8_2 ==&gt; 3 x 3</span></span><br><span class="line"><span class="comment"># conv9_2 ==&gt; 1 x 1</span></span><br><span class="line">mbox_source_layers = ['conv4_3', 'fc7', 'conv6_2', 'conv7_2', 'conv8_2', 'conv9_2']</span><br><span class="line"><span class="comment"># in percent %</span></span><br><span class="line">min_ratio = 20</span><br><span class="line">max_ratio = 90</span><br><span class="line">step = int(math.floor((max_ratio - min_ratio) / (len(mbox_source_layers) - 2)))</span><br><span class="line">min_sizes = []</span><br><span class="line">max_sizes = []</span><br><span class="line">for ratio in xrange(min_ratio, max_ratio + 1, step):</span><br><span class="line">  min_sizes.append(min_dim * ratio / 100.)</span><br><span class="line">  max_sizes.append(min_dim * (ratio + step) / 100.)</span><br><span class="line">min_sizes = [min_dim * 10 / 100.] + min_sizes</span><br><span class="line">max_sizes = [min_dim * 20 / 100.] + max_sizes</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>L2 Normalization on conv4_3</strong><br>作者在conv4_3后加入了L2 Normalization，见protxt：</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">layer </span>&#123;</span><br><span class="line"><span class="symbol">  name:</span> <span class="string">"conv4_3_norm"</span></span><br><span class="line"><span class="symbol">  type:</span> <span class="string">"Normalize"</span></span><br><span class="line"><span class="symbol">  bottom:</span> <span class="string">"conv4_3"</span></span><br><span class="line"><span class="symbol">  top:</span> <span class="string">"conv4_3_norm"</span></span><br><span class="line">  <span class="class">norm_param </span>&#123;</span><br><span class="line"><span class="symbol">    across_spatial:</span> false</span><br><span class="line">    <span class="class">scale_filler </span>&#123;</span><br><span class="line"><span class="symbol">      type:</span> <span class="string">"constant"</span></span><br><span class="line"><span class="symbol">      value:</span> <span class="number">20.0</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="symbol">    channel_shared:</span> false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>为什么要加入L2 Normalization?<br>参见作者的<a href="https://github.com/weiliu89/caffe/issues/241" target="_blank" rel="noopener">回答:</a><br><code>That was discovered in my other paper (ParseNet) that conv4_3 has different scale from other layers. That is why I add L2 normalization for conv4_3 only.</code><br>在这个issue下ujsyehao贴出了不同层的权重的分布图<br><img src="https://user-images.githubusercontent.com/17454232/37581759-e15bcc98-2b84-11e8-9945-1325dcaf206a.png" alt=""><br>实际上就是对conv4_3的特征图在通道维度上做归一化，再乘以系数20.</p>
<ol start="3">
<li><strong>Variance的作用</strong><br>PriorBox layers的参数Variance的作用：the major goal of including the variance is to scale the gradient<br>参见作者的回答:<br><a href="https://github.com/weiliu89/caffe/issues/75" target="_blank" rel="noopener">https://github.com/weiliu89/caffe/issues/75</a><br><a href="https://github.com/weiliu89/caffe/issues/155" target="_blank" rel="noopener">https://github.com/weiliu89/caffe/issues/155</a><br><a href="https://github.com/weiliu89/caffe/issues/629" target="_blank" rel="noopener">https://github.com/weiliu89/caffe/issues/629</a></li>
</ol>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Object-Detection/" rel="tag"># Object Detection</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/09/20/NeuroIoU-Learning-a-Surrogate-Loss-for-Semantic-Segmentation/" rel="next" title="论文阅读 - NeuroIoU: Learning a Surrogate Loss for Semantic Segmentation<br>(BMVC 2018)">
                <i class="fa fa-chevron-left"></i> 论文阅读 - NeuroIoU: Learning a Surrogate Loss for Semantic Segmentation<br>(BMVC 2018)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Bin Zhang</p>
              <p class="site-description motion-element" itemprop="description">I am currently a Master candidate in Wuhan University majoring Photogrammetry and remote sensing</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">26</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/zhangbin0917" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:bin.zhang@whu.edu.cn" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Network-Structure"><span class="nav-text">Network Structure</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Base-Network"><span class="nav-text">Base Network</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Multi-scale-feature-maps-for-detection"><span class="nav-text">Multi-scale feature maps for detection</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Convolutional-predictors-for-detection"><span class="nav-text">Convolutional predictors for detection</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#训练时需要解决的问题"><span class="nav-text">训练时需要解决的问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Matching-strategy"><span class="nav-text">Matching strategy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Training-objective"><span class="nav-text">Training objective</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Choosing-scales-and-aspect-ratios-for-default-boxes"><span class="nav-text">Choosing scales and aspect ratios for default boxes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hard-negative-mining"><span class="nav-text">Hard negative mining</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Data-augmentation"><span class="nav-text">Data augmentation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Non-Maximum-Suppression"><span class="nav-text">Non-Maximum Suppression</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Experimental-Results"><span class="nav-text">Experimental Results</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#PASCAL-VOC2007"><span class="nav-text">PASCAL VOC2007</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Model-analysis"><span class="nav-text">Model analysis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PASCAL-VOC2012"><span class="nav-text">PASCAL VOC2012</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#COCO"><span class="nav-text">COCO</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Data-Augmentation-for-Small-Object-Accuracy"><span class="nav-text">Data Augmentation for Small Object Accuracy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Inference-time"><span class="nav-text">Inference time</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#其他细节"><span class="nav-text">其他细节</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bin Zhang</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="Symbols count total">137k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="Reading time total">2:04</span>
  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Gemini</a> v6.4.1</div>




        








        
      </div>
    </footer>

    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  



  
  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.1"></script>



  



  










  





  

  

  

  
  

  
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
  


  
  

  

  

  

  

  

</body>
</html>
